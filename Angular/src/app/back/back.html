<div class="back-container">
  <!-- 搜尋區 -->
  <div class="back-search">
    <mat-icon aria-hidden="false" fontIcon="search" class="search-icon"></mat-icon>

    <input [(ngModel)]="search_name" (keyup)="search_name_function()" placeholder="搜尋問卷名稱" type="text"
      class="back-input" />

    <label class="back-label" for="start-date">開始時間:</label>
    <input id="start-date" [(ngModel)]="search_start_time" (change)="search_name_function()" type="date" class="back-input" />

    <label class="back-label" for="end-date">結束時間:</label>
    <input id="end-date" [(ngModel)]="search_end_time" (change)="search_name_function()" type="date" class="back-input" [disabled]="!search_start_time" />
  </div>

  <!-- 功能按鈕列 -->
  <div class="back-bar">
    <button mat-mini-fab color="accent" (click)="add()" matTooltip="新增">
      <mat-icon>add</mat-icon>
    </button>
    <button mat-mini-fab color="warn" (click)="login_out()" matTooltip="登出">
      <mat-icon>logout</mat-icon>
    </button>
  </div>

  <!-- 表格區 -->
  <div class="back-table">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

      <!-- 編號 -->
      <ng-container matColumnDef="question_ID">
        <th mat-header-cell *matHeaderCellDef>編號</th>
        <td mat-cell *matCellDef="let element">{{ element.id }}</td>
      </ng-container>

      <!-- 名稱 -->
      <ng-container matColumnDef="question_name">
        <th mat-header-cell *matHeaderCellDef>名稱</th>
        <td mat-cell *matCellDef="let element">
          @if(getQuestionState(element)!="尚未開始" && getQuestionState(element)!="未發布"){
            <a [routerLink]="['/feedback', element.id]" class="link-style">
              {{ element.name }}
            </a>
          }@else{
            <label class="link-style">{{ element.name }}</label>
          }
        </td>
      </ng-container>

      <!-- 狀態 -->
      <ng-container matColumnDef="question_state">
        <th mat-header-cell *matHeaderCellDef>狀態</th>
        <td mat-cell *matCellDef="let element"
          [ngStyle]="{ color: getQuestionState(element) === '進行中' ? 'blue' : 'black' }">
          {{getQuestionState(element)}}
        </td>
      </ng-container>

      <!-- 開始時間 -->
      <ng-container matColumnDef="date_start">
        <th mat-header-cell *matHeaderCellDef>開始時間</th>
        <td mat-cell *matCellDef="let element">{{ element.start_Time }}</td>
      </ng-container>

      <!-- 結束時間 -->
      <ng-container matColumnDef="date_end">
        <th mat-header-cell *matHeaderCellDef>結束時間</th>
        <td mat-cell *matCellDef="let element">{{ element.end_Time }}</td>
      </ng-container>

      <!-- 編輯 -->
      <ng-container matColumnDef="edit">
        <th mat-header-cell *matHeaderCellDef>編輯</th>
        <td mat-cell *matCellDef="let element">
          @if(getQuestionState(element)=="尚未開始" || getQuestionState(element)=="未發布"){
          <mat-icon class="update-icon" aria-hidden="false" fontIcon="edit" title="編輯"
            [routerLink]="['/edit', element.id]"></mat-icon>
          }@else{
            <label>－</label>
          }
        </td>
      </ng-container>

      <!-- 刪除 -->
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>刪除</th>
        <td mat-cell *matCellDef="let element; let i = index">
          @if(getQuestionState(element)!="進行中"){
            <mat-icon aria-hidden="false" fontIcon="delete" class="delete-icon" (click)="delete(i)" title="刪除"></mat-icon>
          }@else{
            <label>－</label>
          }
        </td>
      </ng-container>


      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons aria-label="分頁選擇">
    </mat-paginator>
  </div>
</div>
